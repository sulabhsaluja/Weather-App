<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌤 Weather App</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      color: #e0e0e0;
    }
    .container {
      background: rgba(40, 40, 40, 0.75);
      backdrop-filter: blur(12px);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
      text-align: center;
      max-width: 800px;
      width: 100%;
    }
    h1 {
      font-size: 2.2rem;
      margin-bottom: 20px;
      font-weight: bold;
      color: #ffdd57;
    }
    .search {
      display: flex;
      justify-content: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
      border-radius: 50px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.15);
    }
    .search input {
      flex: 1;
      padding: 14px 15px;
      font-size: 1rem;
      border: none;
      outline: none;
      background: transparent;
      color: #f5f5f5;
    }
    .search input::placeholder { color: rgba(255, 255, 255, 0.7); }
    .search button {
      padding: 14px 20px;
      font-size: 1rem;
      background: linear-gradient(135deg, #ff7eb3, #ff758c);
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }
    .search button:hover { background: linear-gradient(135deg, #ff8eb8, #ff8698); }

    /* Celsius / Fahrenheit Toggle */
    #unit-toggle {
      margin: 15px auto 0;
      display: block;
      padding: 12px 28px;
      border-radius: 30px;
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: #fff;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }
    #unit-toggle:hover {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      transform: scale(1.05);
    }
    #unit-toggle.active {
      background: linear-gradient(135deg, #ff7eb3, #ff758c);
    }

    #current-weather {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      padding: 15px;
      margin-top: 10px;
      text-align: left;
      line-height: 1.8;
    }
    #current-weather h2 { margin-bottom: 10px; }

    /* Chart Section */
    .chart-container {
      display: none;
      margin-top: 20px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
    }
    .chart-container h3 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.2rem;
      color: #ffdd57;
    }
    canvas { background: transparent; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🌤 Weather App</h1>
    <div class="search">
      <input type="text" id="city-input" placeholder="Enter city name">
      <button id="search-btn">Search</button>
    </div>
    <button id="unit-toggle">°C / °F</button>

    <div id="current-weather"></div>
    <div class="chart-container">
      <h3>📊 5-Day Forecast</h3>
      <canvas id="weather-chart"></canvas>
    </div>
  </div>

  <script>
    const apiKey = "a16d5af02d632e6888b926134f975957"; 
    const currentWeatherDiv = document.getElementById("current-weather");
    const searchBtn = document.getElementById("search-btn");
    const cityInput = document.getElementById("city-input");
    const unitToggle = document.getElementById("unit-toggle");
    const chartContainer = document.querySelector(".chart-container");
    let currentUnit = "metric"; 
    let weatherChart;

    const weatherIcons = {
      Clear: "☀️",
      Clouds: "☁️",
      Rain: "🌧️",
      Drizzle: "🌦️",
      Thunderstorm: "⛈️",
      Snow: "❄️",
      Mist: "🌫️",
      Smoke: "💨",
      Haze: "🌫️",
      Dust: "🌪️",
      Fog: "🌫️",
      Sand: "🏜️",
      Ash: "🌋",
      Squall: "💨",
      Tornado: "🌪️"
    };

    async function fetchWeather(city) {
      try {
        // Current weather
        const weatherRes = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=${currentUnit}&appid=${apiKey}`
        );
        const weatherData = await weatherRes.json();

        if (weatherData.cod !== 200) {
          currentWeatherDiv.innerHTML = `<p>❌ City not found</p>`;
          chartContainer.style.display = "none"; // hide chart
          return;
        }

        // Forecast (5 days)
        const forecastRes = await fetch(
          `https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=${currentUnit}&appid=${apiKey}`
        );
        const forecastData = await forecastRes.json();

        displayWeather(weatherData);
        displayChart(forecastData);
      } catch (error) {
        currentWeatherDiv.innerHTML = `<p>⚠️ Error fetching data</p>`;
        chartContainer.style.display = "none";
      }
    }

    function displayWeather(data) {
      const icon = weatherIcons[data.weather[0].main] || "🌤";
      const unitSymbol = currentUnit === "metric" ? "°C" : "°F";

      currentWeatherDiv.innerHTML = `
        <h2>${icon} ${data.name}, ${data.sys.country}</h2>
        <p><b>🌡 Temperature:</b> ${data.main.temp} ${unitSymbol}</p>
        <p><b>🤔 Feels Like:</b> ${data.main.feels_like} ${unitSymbol}</p>
        <p><b>💧 Humidity:</b> ${data.main.humidity}%</p>
        <p><b>🌬 Wind:</b> ${data.wind.speed} ${currentUnit === "metric" ? "m/s" : "mph"}</p>
        <p><b>📋 Condition:</b> ${data.weather[0].description}</p>
      `;
    }

    function displayChart(forecastData) {
      const labels = [];
      const temps = [];
      const unitSymbol = currentUnit === "metric" ? "°C" : "°F";

      // Pick one forecast per day (every 8th item ≈ 24h)
      for (let i = 0; i < forecastData.list.length; i += 8) {
        const item = forecastData.list[i];
        const date = new Date(item.dt * 1000);
        labels.push(date.toLocaleDateString("en-US", { weekday: "short" }));
        temps.push(item.main.temp);
      }

      if (weatherChart) weatherChart.destroy();

      const ctx = document.getElementById("weather-chart").getContext("2d");
      weatherChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [{
            label: `Temperature (${unitSymbol})`,
            data: temps,
            borderColor: "#ffdd57",
            backgroundColor: "rgba(255, 221, 87, 0.2)",
            fill: true,
            tension: 0.4,
            pointBackgroundColor: "#ffdd57",
            pointRadius: 5,
            pointHoverRadius: 7
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { labels: { color: "#fff" } } },
          scales: {
            x: { ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.2)" } },
            y: { ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.2)" } }
          }
        }
      });

      chartContainer.style.display = "block";
    }

    // Search button
    searchBtn.addEventListener("click", () => {
      const city = cityInput.value.trim();
      if (city) {
        fetchWeather(city);
      } else {
        getLocationOrDefault();
      }
    });

    // Unit toggle
    unitToggle.addEventListener("click", () => {
      currentUnit = currentUnit === "metric" ? "imperial" : "metric";
      unitToggle.classList.toggle("active");
      const city = cityInput.value.trim() || "Delhi";
      fetchWeather(city);
    });

    // Default behavior: Try location, else Delhi
    function getLocationOrDefault() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            const res = await fetch(
              `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=${currentUnit}&appid=${apiKey}`
            );
            const data = await res.json();
            fetchWeather(data.name);
          },
          () => {
            fetchWeather("Delhi");
          }
        );
      } else {
        fetchWeather("Delhi");
      }
    }

    // Load default city
    window.onload = getLocationOrDefault;
  </script>
</body>
</html>
